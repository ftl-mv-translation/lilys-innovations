<FTL>

<mod:findName type="event" name="STORAGE_CHECK_SYSTEM">
    <mod-append:choice req="lily_ablative_armor" hidden="true"  blue="false">
        <text>Ablative Armor.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR"/>
    </mod-append:choice>
    <mod-append:choice req="lily_targeting_core" hidden="true" blue="false">
        <text>Dedicated Targeting Core.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE"/>
    </mod-append:choice>
    <mod-append:choice req="lily_ecm_suite" hidden="true" blue="false">
        <text>ECM Suite.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE"/>
    </mod-append:choice>
    <mod-append:choice req="lily_infusion_bay" hidden="true" blue="false">
        <text>Infusion Bay.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY"/>
    </mod-append:choice>
    <mod-append:choice req="lily_shock_neutralizer" hidden="true" blue="false">
        <text>Shock Neutralizer.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER"/>
    </mod-append:choice>
    <mod-append:choice req="lily_system_bracers" hidden="true" blue="false">
        <text>System Bracers.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS"/>
    </mod-append:choice>
    <mod-append:choice req="lily_fiber_liner" hidden="true" blue="false">
        <text>Fiber Liner.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER"/>
    </mod-append:choice>
    <mod-append:choice req="oxygen" hidden="true" blue="false">
        <text>Life Support.</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN"/>
    </mod-append:choice>
    <mod:findLike type="choice" reverse="false" start="1">
        <mod:selector req="oxygen"/>
        <mod:removeTag/>
    </mod:findLike>
    <mod-append:choice req="sensors" hidden="true" blue="false">
        <text>Sensors.</text>
        <event load="STORAGE_CHECK_SYSTEM_SENSORS"/>
    </mod-append:choice>
    <mod:findLike type="choice" reverse="false" start="1">
        <mod:selector req="sensors"/>
        <mod:removeTag/>
    </mod:findLike>
</mod:findName>



<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_AETHER">
    <mod-append:choice req="UPG_LILY_AETHER_ARMOR" lvl="1" max_group="10" blue="false" hidden="true">
        <text>Aether Infused Armor. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_AETHER_ARMOR" lvl="0" max_group="10" blue="false" hidden="true">
        <text>Aether Infused Armor. [Cost: 65~, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_AETHER_LILY_AETHER_ARMOR"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_BRACERS_AETHER" lvl="1" max_group="11" blue="false" hidden="true">
        <text>Aether Integrity Field. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_BRACERS_AETHER" lvl="0" max_group="11" blue="false" hidden="true">
        <text>Aether Integrity Field. [Cost: 50~, 5{, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_AETHER_LILY_BRACERS_AETHER"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_FIBER_AETHER" lvl="1" max_group="12" blue="false" hidden="true">
        <text>Aether Fiber Clothing. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_FIBER_AETHER" lvl="0" max_group="12" blue="false" hidden="true">
        <text>Aether Fiber Clothing. [Cost: 40~, 8{, 6|]</text>
        <event load="STORAGE_CHECK_SYSTEM_AETHER_LILY_FIBER_AETHER"/>
    </mod-append:choice>
        

</mod:findName>


<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_DRONES">
    <mod-append:choice req="UPG_LILY_DRONE_BOARDING_SMART" lvl="1" max_group="10" blue="false" hidden="true">
        <text>Smart Boarding. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_DRONE_BOARDING_SMART" lvl="0" max_group="10" blue="false" hidden="true">
        <text>Smart Boarding. [Cost: 50~, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_DRONES_LILY_DRONE_BOARDING_SMART"/>
    </mod-append:choice>
</mod:findName>

<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_CLONEBAY">
    <mod-append:choice req="UPG_LILY_CLONEBAY_REGEN" lvl="1" max_group="10" blue="false" hidden="true">
        <text>Backup Repair Protocols. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_CLONEBAY_REGEN" lvl="0" max_group="10" blue="false" hidden="true">
        <text>Backup Repair Protocols. [Cost: 20~, 4|]</text>
        <event load="STORAGE_CHECK_SYSTEM_CLONEBAY_LILY_CLONEBAY_REGEN"/>
    </mod-append:choice>
</mod:findName>


<event name="STORAGE_CHECK_SYSTEM_CLONEBAY_LILY_CLONEBAY_REGEN">
    <text>You are about to install the Backup Repair Protocols upgrade.
	[Effects: Slowly repairs your clonebay system even with absense of crew.]</text>

    <choice req="BACKUP_DNA" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 4|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="drones" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_CLONEBAY_REGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="BACKUP_DNA" lvl="0" max_lvl="0" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need to have Backup DNA installed.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_CLONEBAY_REGEN" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_CLONEBAY_REGEN"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_CLONEBAY_REGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_CLONEBAY_REGEN">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_CLONEBAY_REGEN</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_PILOT">
    <mod-append:choice req="UPG_LILY_PILOT_FOCUS" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Mind Shielding. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_PILOT_FOCUS" lvl="0" max_group="5" blue="false" hidden="true">
        <text>Mind Shielding. [Cost: 30~, 4{]</text>
        <event load="STORAGE_CHECK_SYSTEM_PILOT_LILY_PILOT_FOCUS"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_INN_PILOT" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Integrated Neural Network. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_INN_PILOT" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Integrated Neural Network. [Cost: 30~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_PILOT_LILY_INN_PILOT"/>
    </mod-append:choice>

</mod:findName>

<event name="STORAGE_CHECK_SYSTEM_PILOT_LILY_PILOT_FOCUS">
    <text>You are about to install the Mind Shielding upgrade.
	[Effects: Crew in piloting becomes immune to mind control and stun.]</text>

    <choice req="pilot" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 4{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="fuel" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_PILOT_FOCUS"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Pilot level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_PILOT_FOCUS" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_PILOT_FOCUS"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_PILOT_FOCUS"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_PILOT_FOCUS">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_PILOT_FOCUS</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_PILOT_LILY_INN_PILOT">
    <text>You are about to install the Integrated Neural Network upgrade.
	[Effects: Integrated Neural Network can operate Pilot subsystem even in the absense of crew.]</text>

    <choice req="pilot" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INN_PILOT"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Pilot level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_INN_PILOT" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_INN_PILOT"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INN_PILOT"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INN_PILOT">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_INN_PILOT</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>




<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_TELEPORTER">
    <mod-append:choice req="UPG_LILY_TELEPORT_RECALL" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Emergency Teleport Recall. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_TELEPORT_RECALL" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Emergency Teleport Recall. [Cost: 30~, 3{, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_TELEPORTER_LILY_TELEPORT_RECALL"/>
    </mod-append:choice>
</mod:findName>

<event name="STORAGE_CHECK_SYSTEM_TELEPORTER_LILY_TELEPORT_RECALL">
    <text>You are about to install the Emergency Teleport Recall upgrade.
	[Effects: Automatically teleports your crew back to your ship if the enemy ship is destroyed or jumping.]</text>

    <choice req="teleporter" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 3{, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="fuel" min="-3" max="-3"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TELEPORT_RECALL"/>
            </choice>
        </event>
    </choice>
    <choice req="teleporter" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Teleporter level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TELEPORT_RECALL" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TELEPORT_RECALL"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TELEPORT_RECALL"/>
            </choice>
        </event>
    </choice>
    <choice req="teleporter" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TELEPORT_RECALL">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TELEPORT_RECALL</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_SENSORS">
    <mod-append:choice req="UPG_LILY_INN_SENSORS" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Integrated Neural Network. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_INN_SENSORS" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Integrated Neural Network. [Cost: 30~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_SENSORS_LILY_INN_SENSORS"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_SENSORS_MAPWIDE" lvl="1" max_group="7" blue="false" hidden="true">
        <text>Mapping Suite. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_SENSORS_MAPWIDE" lvl="0" max_group="7" blue="false" hidden="true">
        <text>Mapping Suite. [Cost: 40~, 3{, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_SENSORS_LILY_SENSORS_MAPWIDE"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_SECTOR_SCANNER" lvl="1" max_group="8" blue="false" hidden="true">
        <text>Sector Scanner. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_SECTOR_SCANNER" lvl="0" max_group="8" blue="false" hidden="true">
        <text>Sector Scanner. [Cost: 20~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_SENSORS_LILY_SECTOR_SCANNER"/>
    </mod-append:choice>
</mod:findName>


<event name="STORAGE_CHECK_SYSTEM_SENSORS">
    <text>What upgrade do you want to install?</text>

    <choice req="UPG_LILY_INN_SENSORS" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Integrated Neural Network. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INN_SENSORS" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Integrated Neural Network. [Cost: 30~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_SENSORS_LILY_INN_SENSORS"/>
    </choice>
    <choice req="UPG_LILY_SENSORS_MAPWIDE" lvl="1" max_group="7" blue="false" hidden="true">
        <text>Mapping Suite. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_SENSORS_MAPWIDE" lvl="0" max_group="7" blue="false" hidden="true">
        <text>Mapping Suite. [Cost: 40~, 3{, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_SENSORS_LILY_SENSORS_MAPWIDE"/>
    </choice>
    <choice req="UPG_LILY_SECTOR_SCANNER" lvl="1" max_group="8" blue="false" hidden="true">
        <text>Sector Scanner. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_SECTOR_SCANNER" lvl="0" max_group="8" blue="false" hidden="true">
        <text>Sector Scanner. [Cost: 20~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_SENSORS_LILY_SECTOR_SCANNER"/>
    </choice>

    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>

<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_SENSORS" reverse="false" start="1">
    <mod:removeTag/>
</mod:findName>

<event name="STORAGE_CHECK_SYSTEM_SENSORS_LILY_INN_SENSORS">
    <text>You are about to install the Integrated Neural Network upgrade.
	[Effects: Integrated Neural Network can operate Sensors subsystem even in the absense of crew.]</text>

    <choice req="sensors" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INN_SENSORS"/>
            </choice>
        </event>
    </choice>
    <choice req="sensors" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Sensors level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_INN_SENSORS" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_INN_SENSORS"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INN_SENSORS"/>
            </choice>
        </event>
    </choice>
    <choice req="sensors" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INN_SENSORS">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_INN_SENSORS</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_SENSORS_LILY_SENSORS_MAPWIDE">
    <text>You are about to install the Mapping Suite upgrade.
	[Effects: Allows you to collect information about the beacons of the whole sector. Requires the ship to be stationary for some time.]</text>

    <choice req="sensors" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 3{, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="fuel" min="-3" max="-3"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SENSORS_MAPWIDE"/>
            </choice>
        </event>
    </choice>
    <choice req="sensors" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Sensors level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_SENSORS_MAPWIDE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_SENSORS_MAPWIDE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SENSORS_MAPWIDE"/>
            </choice>
        </event>
    </choice>
    <choice req="sensors" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_SENSORS_MAPWIDE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_SENSORS_MAPWIDE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_SENSORS_LILY_SECTOR_SCANNER">
    <text>You are about to install the Sector Scanner upgrade.
	[Effects: Allows you to collect more information about sectors on you journey, revealing the exact names of all of them when making an inter-sector jump.]</text>

    <choice req="sensors" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SECTOR_SCANNER"/>
            </choice>
        </event>
    </choice>
    <choice req="sensors" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Sensors level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_SECTOR_SCANNER" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_SECTOR_SCANNER"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SECTOR_SCANNER"/>
            </choice>
        </event>
    </choice>
    <choice req="sensors" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_SECTOR_SCANNER">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_SECTOR_SCANNER</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>




<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_DOORS">
    <mod-append:choice req="UPG_LILY_BUNKER_DOORS" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Fortifications. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_BUNKER_DOORS" lvl="0" max_group="5" blue="false" hidden="true">
        <text>Fortifications. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_DOORS_LILY_DOORS_BUNKER"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_DOORS_FAILSAFE" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Failsafe. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_DOORS_FAILSAFE" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Failsafe. [Cost: 10~, 1|]</text>
        <event load="STORAGE_CHECK_SYSTEM_DOORS_LILY_DOORS_FAILSAFE"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_INN_DOORS" lvl="1" max_group="7" blue="false" hidden="true">
        <text>Integrated Neural Network. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_INN_DOORS" lvl="0" max_group="7" blue="false" hidden="true">
        <text>Integrated Neural Network. [Cost: 30~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_DOORS_LILY_INN_DOORS"/>
    </mod-append:choice>


</mod:findName>


<event name="STORAGE_CHECK_SYSTEM_DOORS_LILY_DOORS_BUNKER">
    <text>You are about to install the Fortifications upgrade.
	[Effects: Allied crew in Doors room take half damage from all sources, and enemy crew sabotage it at half speed.]</text>

    <choice req="doors" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BUNKER_DOORS"/>
            </choice>
        </event>
    </choice>
    <choice req="doors" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Doors level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BUNKER_DOORS" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BUNKER_DOORS"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BUNKER_DOORS"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BUNKER_DOORS">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BUNKER_DOORS</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_DOORS_LILY_DOORS_FAILSAFE">
    <text>You are about to install the Failsafe upgrade.
	[Effects: All doors and airlocks are automatically shut closed if Doors system is destroyed or disabled.]</text>

    <choice req="doors" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 10~, 1|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-10" max="-10"/>
                <item type="drones" min="-1" max="-1"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_DOORS_FAILSAFE"/>
            </choice>
        </event>
    </choice>
    <choice req="doors" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Doors level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_DOORS_FAILSAFE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_DOORS_FAILSAFE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_DOORS_FAILSAFE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_DOORS_FAILSAFE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_DOORS_FAILSAFE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_DOORS_LILY_INN_DOORS">
    <text>You are about to install the Integrated Neural Network upgrade.
	[Effects: Integrated Neural Network can operate Doors subsystem even in the absense of crew.]</text>

    <choice req="doors" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INN_DOORS"/>
            </choice>
        </event>
    </choice>
    <choice req="doors" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Doors level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_INN_DOORS" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_INN_DOORS"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INN_DOORS"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INN_DOORS">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_INN_DOORS</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_DRONES_LILY_DRONE_BOARDING_SMART">
    <text>You are about to install the Smart Boarding upgrade.
	[Effects: Makes your boarding drones prioritize landing in important enemy rooms.]</text>

    <choice req="drones" lvl="4" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="drones" min="-5" max="-5"/>
                <item type="scrap" min="-50" max="-50"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_DRONE_BOARDING_SMART"/>
            </choice>
        </event>
    </choice>
    <choice req="drones" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Drone Control level 4.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_DRONE_BOARDING_SMART" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_DRONE_BOARDING_SMART"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_DRONE_BOARDING_SMART"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_DRONE_BOARDING_SMART">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_DRONE_BOARDING_SMART</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>




<event name="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR">
    <text>What upgrade do you want to install?</text>
    <choice req="UPG_LILY_POLISHED_ARMOR" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Polished Armor. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_POLISHED_ARMOR" lvl="0" max_group="0" blue="false" hidden="true">
        <text>Polished Armor. [Cost: 75~, 5{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_POLISHED"/>
    </choice>

    <choice req="UPG_LILY_REACTIVE_ARMOR" lvl="1" max_group="1" blue="false" hidden="true">
        <text>Reactive Armor. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_REACTIVE_ARMOR" lvl="0" max_group="1" blue="false" hidden="true">
        <text>Reactive Armor. [Cost: 80~, 10}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_REACTIVE"/>
    </choice>

    <choice req="UPG_LILY_STRONG_ARMOR" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Double-Strength Armor. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_STRONG_ARMOR" lvl="0" max_group="2" blue="false" hidden="true">
        <text>Double-Strength Armor. [Cost: 100~]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_STRONG"/>
    </choice>

    <choice req="UPG_LILY_REGEN_ARMOR" lvl="1" max_group="3" blue="false" hidden="true">
        <text>Mending Armor. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_REGEN_ARMOR" lvl="0" max_group="3" blue="false" hidden="true">
        <text>Mending Armor. [Cost: 60~, 10|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_REGEN"/>
    </choice>
    
    <choice req="UPG_LILY_VENGEANCE_ARMOR" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Vengeance Adapter. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_VENGEANCE_ARMOR" lvl="0" max_group="5" blue="false" hidden="true">
        <text>Vengeance Adapter. [Cost: 20~, 4}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_VENGEANCE"/>
    </choice>

    <choice req="UPG_LILY_BUNKER_ARMOR" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Fortifications. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_BUNKER_ARMOR" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Fortifications. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_BUNKER"/>
    </choice>

    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_POLISHED">
    <text>You are about to install the Polished Armor upgrade.
	[Effects: Decreases damage taken by ablative armor from beams by 1.]</text>

    <choice req="lily_ablative_armor" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 75~, 5{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="fuel" min="-5" max="-5"/>
                <item type="scrap" min="-75" max="-75"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_POLISHED_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ablative_armor" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Ablative Armor level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_POLISHED_ARMOR" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_POLISHED_ARMOR"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_POLISHED_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_POLISHED_ARMOR">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_POLISHED_ARMOR</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_REACTIVE">
    <text>You are about to install the Reactive Armor upgrade.
	[Effects: When Ablative Armor absorbs damage, it also releases a burst of debris to intercept incoming projectiles or drones.]</text>

    <choice req="lily_ablative_armor" lvl="5" max_group="0" blue="false" hidden="true">
    <!--choice req="INSTALL_LILY_REACTIVE" max_group="0" blue="false" hidden="true"-->
        <text>Perform the upgrade. [Cost: 80~, 10}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="missiles" min="-10" max="-10"/>
                <item type="scrap" min="-80" max="-80"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_REACTIVE_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ablative_armor" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Ablative Armor level 5.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_REACTIVE_ARMOR" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_REACTIVE_ARMOR"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_REACTIVE_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_REACTIVE_ARMOR">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_REACTIVE_ARMOR</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_STRONG">
    <text>You are about to install the Double-Strength Armor upgrade.
	[Effects: Improves chances of Ablative Armor to absorb system or crew damage. Also increases the chance to resist hull and system damage by extra 10%.]</text>

    <choice req="lily_ablative_armor" lvl="4" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 100~]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-100" max="-100"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_STRONG_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ablative_armor" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Ablative Armor level 4.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_STRONG_ARMOR" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_STRONG_ARMOR"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_STRONG_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_STRONG_ARMOR">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_STRONG_ARMOR</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_REGEN">
    <text>You are about to install the Mending Armor upgrade.
	[Effects: If Ablative Armor system is present, repairs 2 hull points per jump.]</text>

    <choice req="lily_ablative_armor" lvl="4" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 60~, 10|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="drones" min="-10" max="-10"/>
                <item type="scrap" min="-60" max="-60"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_REGEN_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ablative_armor" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Ablative Armor level 4.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_REGEN_ARMOR" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_REGEN_ARMOR"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_REGEN_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_REGEN_ARMOR">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_REGEN_ARMOR</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_VENGEANCE">
    <text>You are about to install the Vengeance Adapter upgrade.
	[Effects: Allows effects that trigger on hull damage trigger on armor damage as well.]</text>

    <choice req="lily_ablative_armor" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 4}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="missiles" min="-4" max="-4"/>
                <item type="scrap" min="-20" max="-20"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_VENGEANCE_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ablative_armor" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Ablative Armor level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_VENGEANCE_ARMOR" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_VENGEANCE_ARMOR"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_VENGEANCE_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_VENGEANCE_ARMOR">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_VENGEANCE_ARMOR</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_LILY_ABLATIVE_ARMOR_BUNKER">
    <text>You are about to install the Fortifications upgrade.
	[Effects: Allied crew in Ablative Armor room take half damage from all sources, and enemy crew sabotage it at half speed.]</text>

    <choice req="lily_ablative_armor" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BUNKER_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ablative_armor" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Ablative Armor level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BUNKER_ARMOR" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BUNKER_ARMOR"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BUNKER_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BUNKER_ARMOR">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BUNKER_ARMOR</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_AETHER_LILY_AETHER_ARMOR">
    <text>You are about to install the Aether Infused Armor upgrade.
	[Effects: Increases chance to resist armor and hull damage by 10% and allows Ablative Armor layers benefit from resist chance.]</text>

    <choice req="UPG_LILY_STRONG_ARMOR" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 65~, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="drones" min="-5" max="-5"/>
                <item type="scrap" min="-65" max="-65"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_AETHER_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="UPG_LILY_STRONG_ARMOR" lvl="0" max_lvl="0" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Double-Strength Armor installed first. (Ablative Armor)</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_AETHER_ARMOR" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_AETHER_ARMOR"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_AETHER_ARMOR"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_AETHER_ARMOR">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_AETHER_ARMOR</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER">
    <text>What upgrade do you want to install?</text>
    <choice req="UPG_LILY_SECONDARY_ION_FIELD" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Secondary Ion Field. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_SECONDARY_ION_FIELD" lvl="0" max_group="0" blue="false" hidden="true">
        <text>Secondary Ion Field. [Cost: 50~, 2{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_ION_FIELD"/>
    </choice>

    <choice req="UPG_LILY_WIDE_NEUTRALIZE" lvl="2" max_group="1" blue="false" hidden="true">
        <text>Expanded Field. [MAX LVL ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_WIDE_NEUTRALIZE" lvl="1" max_lvl="1" max_group="1" blue="false" hidden="true">
        <text>Expanded Field LvL 2. [Cost: 80~, 5{, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_WIDE"/>
    </choice>
    <choice req="UPG_LILY_WIDE_NEUTRALIZE" lvl="0" max_lvl="0" max_group="1" blue="false" hidden="true">
        <text>Expanded Field LvL 1. [Cost: 80~, 5{, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_WIDE"/>
    </choice>

    <choice req="UPG_LILY_PLASMA_NEUTRALIZE" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Surge Protectors. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_PLASMA_NEUTRALIZE" lvl="0" max_group="2" blue="false" hidden="true">
        <text>Surge Protectors. [Cost: 30~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_PLASMA"/>
    </choice>

    <choice req="UPG_LILY_STUN_NEUTRALIZE" lvl="1" max_group="3" blue="false" hidden="true">
        <text>Surge Protectors. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_STUN_NEUTRALIZE" lvl="0" max_group="3" blue="false" hidden="true">
        <text>Neural Neutralizer. [Cost: 30~, 3{, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_STUN"/>
    </choice>

    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_ION_FIELD">
    <text>You are about to install the Secondary Ion Field upgrade.
	[Effects: Protects your ship from ion damage, giving a 30% chance to negate it entirely. Stacks.]</text>

    <choice req="lily_shock_neutralizer" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 2{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="fuel" min="-2" max="-2"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SECONDARY_ION_FIELD"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_shock_neutralizer" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Shock Neutralizer level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_SECONDARY_ION_FIELD" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_SECONDARY_ION_FIELD"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SECONDARY_ION_FIELD"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_SECONDARY_ION_FIELD">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_SECONDARY_ION_FIELD</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_WIDE">
    <text>You are about to install the Expanded Field upgrade.
	[Effects: Shock Neutralizer also provide half of its bonus to rooms adjacent to target. LvL 2 also provides bonus to diagonal rooms.]</text>

    <choice req="lily_shock_neutralizer" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 80~, 5{, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-80" max="-80"/>
                <item type="fuel" min="-5" max="-5"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_WIDE_NEUTRALIZE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_shock_neutralizer" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Shock Neutralizer level 2.</text>
        <event load="OPTION_INVALID"/>s
    </choice>
    <choice req="EX_LILY_WIDE_NEUTRALIZE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_WIDE_NEUTRALIZE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_WIDE_NEUTRALIZE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_WIDE_NEUTRALIZE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_WIDE_NEUTRALIZE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_PLASMA">
    <text>You are about to install the Surge Protectors upgrade.
	[Effects: Protect your ship from Plasma damage, giving 100% chance to negate system damage on shield hits and 50% on direct hits.]</text>

    <choice req="lily_shock_neutralizer" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_PLASMA_NEUTRALIZE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_shock_neutralizer" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Shock Neutralizer level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_PLASMA_NEUTRALIZE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_PLASMA_NEUTRALIZE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_PLASMA_NEUTRALIZE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_PLASMA_NEUTRALIZE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_PLASMA_NEUTRALIZE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_SHOCK_NEUTRALIZER_STUN">
    <text>You are about to install the Neural Neutralizer upgrade.
	[Effects: Shock Neutralizer now also affects crew stun times.]</text>

    <choice req="lily_shock_neutralizer" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 3{, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="fuel" min="-3" max="-3"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_STUN_NEUTRALIZE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_shock_neutralizer" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Shock Neutralizer level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_STUN_NEUTRALIZE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_STUN_NEUTRALIZE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_STUN_NEUTRALIZE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_STUN_NEUTRALIZE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_STUN_NEUTRALIZE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>




<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY">
    <text>What upgrade do you want to install?</text>
    <!--choice req="UPG_LILY_INFUSION_OVERLOADED_UNLOCK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Overloaded Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_CHAOTIC_UNLOCK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Chaotic Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_FIREBORNE_UNLOCK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Fireborne Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Explosive Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_PHOENIX_UNLOCK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Phoenix Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice-->
    <!--choice req="INFUSION_BAY_FOURTH" lvl="1" max_group="1" blue="false" hidden="true">
        <text>Dismantle the installed extra infusions to free up the slot for other ones.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_FOURTH"/>
    </choice-->
    <choice req="INFUSION_BAY_FOURTH" lvl="0" max_lvl="10" max_group="1" blue="false" hidden="true">
        <text>Install extra infusions for the fourth slot of the system.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_INSTALL_FOURTH"/>
    </choice>

    <choice req="UPG_LILY_SICKNESS_RECOVERY" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Sickness Treatment. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_SICKNESS_RECOVERY" lvl="0" max_group="2" blue="false" hidden="true">
        <text>Sickness Treatment. [Cost: 40~, 3{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_RECOVERY"/>
    </choice>

    <choice req="UPG_LILY_INFUSION_HAVEN" lvl="1" max_group="3" blue="false" hidden="true">
        <text>Safe Haven Protocols. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_HAVEN" lvl="0" max_group="3" blue="false" hidden="true">
        <text>Safe Haven Protocols. [Cost: 20~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_HAVEN"/>
    </choice>

    <choice req="pilot" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<mod:findName type="event" name="STORAGE_CHECK_BUTTON">
    <mod-append:choice req="INFUSION_BAY_FOURTH" lvl="1" max_group="1" blue="false" hidden="true">
        <text>Select the infusion type to use for the 4th slot of infusion bay.</text>
        <event load="STORAGE_CHECK_LILY_INFUSION_BAY_SELECT_FOURTH"/>
    </mod-append:choice>
</mod:findName>


<event name="STORAGE_CHECK_LILY_INFUSION_BAY_SELECT_FOURTH">
    <text>Here you can select which infusion type to use for 4th slot of infusion bay. (You need to have intalled the corresponding internal upgrade first.)</text>
    <choice req="UPG_LILY_INFUSION_OVERLOADED_UNLOCK" lvl="0" max_lvl="0" blue="false" hidden="true">
        <text>Overloaded Infusions. [NOT INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_OVERLOADED_UNLOCK" lvl="1" blue="false" hidden="true">
        <text>Overloaded Infusions.</text>
        <event>
            <text>You set the infusion bay to use Overloaded Infusions.</text>
            <variable name="lily_infusion_bay_fourthtype_select" op="set" val="1"/>
            <choice>
                <text>Continue...</text>
                <event load="STORAGE_CHECK"/>
            </choice>
        </event>
    </choice>
    <choice req="UPG_LILY_INFUSION_CHAOTIC_UNLOCK" lvl="0" max_lvl="0" blue="false" hidden="true">
        <text>Chaotic Infusions. [NOT INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_CHAOTIC_UNLOCK" lvl="1" blue="false" hidden="true">
        <text>Chaotic Infusions.</text>
        <event>
            <text>You set the infusion bay to use Chaotic Infusions.</text>
            <variable name="lily_infusion_bay_fourthtype_select" op="set" val="2"/>
            <choice>
                <text>Continue...</text>
                <event load="STORAGE_CHECK"/>
            </choice>
        </event>
    </choice>
    <choice req="UPG_LILY_INFUSION_FIREBORNE_UNLOCK" lvl="0" max_lvl="0" blue="false" hidden="true">
        <text>Fireborne Infusions. [NOT INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_FIREBORNE_UNLOCK" lvl="1" blue="false" hidden="true">
        <text>Fireborne Infusions.</text>
        <event>
            <text>You set the infusion bay to use Fireborne Infusions.</text>
            <variable name="lily_infusion_bay_fourthtype_select" op="set" val="3"/>
            <choice>
                <text>Continue...</text>
                <event load="STORAGE_CHECK"/>
            </choice>
        </event>
    </choice>
    <choice req="UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK" lvl="0" max_lvl="0" blue="false" hidden="true">
        <text>Explosive Infusions. [NOT INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK" lvl="1" blue="false" hidden="true">
        <text>Explosive Infusions.</text>
        <event>
            <text>You set the infusion bay to use Explosive Infusions.</text>
            <variable name="lily_infusion_bay_fourthtype_select" op="set" val="4"/>
            <choice>
                <text>Continue...</text>
                <event load="STORAGE_CHECK"/>
            </choice>
        </event>
    </choice>
    <choice req="UPG_LILY_INFUSION_PHOENIX_UNLOCK" lvl="0" max_lvl="0" blue="false" hidden="true">
        <text>Phoenix Infusions. [NOT INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_PHOENIX_UNLOCK" lvl="1" blue="false" hidden="true">
        <text>Phoenix Infusions.</text>
        <event>
            <text>You set the infusion bay to use Overloaded Infusions.</text>
            <variable name="lily_infusion_bay_fourthtype_select" op="set" val="5"/>
            <choice>
                <text>Continue...</text>
                <event load="STORAGE_CHECK"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK"/>
    </choice>

</event>



<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_RECOVERY">
    <text>You are about to install the Sickness Treatment upgrade.
	[Effects: Crew in the Infusion Bay recover from their Infusion Sickness at an increased rate, corresponding to its current power.
1 Power: 1.75x Infusion Sickness recovery rate.
2 Power: 2.5x Infusion Sickness recovery rate.
3 Power: 3.25x Infusion Sickness recovery rate.]</text>

    <choice req="lily_infusion_bay" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 3{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="fuel" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SICKNESS_RECOVERY"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_infusion_bay" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Infusion bay level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_SICKNESS_RECOVERY" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_SICKNESS_RECOVERY"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_SICKNESS_RECOVERY"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_SICKNESS_RECOVERY">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_SICKNESS_RECOVERY</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_HAVEN">
    <text>You are about to install the Safe Haven Protocols upgrade.
	[Effects: Crew in the Infusion Bay become immune to suffocation and fires, and recover extra 1 HP/s.]</text>

    <choice req="lily_infusion_bay" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INFUSION_HAVEN"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_infusion_bay" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Infusion bay level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_INFUSION_HAVEN" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_INFUSION_HAVEN"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INFUSION_HAVEN"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INFUSION_HAVEN">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_INFUSION_HAVEN</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_FOURTH">
    <text>Are you sure you want to uninstall the fourth slot infusions? No refunds.</text>
    <choice hidden="true">
        <text>Yes, I understand the implications and wish to proceed.</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_FOURTH_REAL"/>
    </choice>
    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_FOURTH_REAL">
    <loadEventList first="true" default="STORAGE_CHECK_SYSTEM_LOAD">
        <event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_OVERLOADED" req="UPG_LILY_INFUSION_OVERLOADED_UNLOCK" lvl="1"/>
        <event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_CHAOTIC" req="UPG_LILY_INFUSION_CHAOTIC_UNLOCK" lvl="1"/>
        <event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_FIREBORNE" req="UPG_LILY_INFUSION_FIREBORNE_UNLOCK" lvl="1"/>
        <event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_EXPLOSIVE" req="UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK" lvl="1"/>
        <event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_PHOENIX" req="UPG_LILY_INFUSION_PHOENIX_UNLOCK" lvl="1"/>
    </loadEventList>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_OVERLOADED">
    <text>You successfully uninstall the extra infusions.</text>
    <remove name="HIDDEN UPG_LILY_INFUSION_OVERLOADED_UNLOCK"/>
    <choice>
        <text>Continue...</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_CHAOTIC">
    <text>You successfully uninstall the extra infusions.</text>
    <remove name="HIDDEN UPG_LILY_INFUSION_CHAOTIC_UNLOCK"/>
    <choice>
        <text>Continue...</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_FIREBORNE">
    <text>You successfully uninstall the extra infusions.</text>
    <remove name="HIDDEN UPG_LILY_INFUSION_FIREBORNE_UNLOCK"/>
    <choice>
        <text>Continue...</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_EXPLOSIVE">
    <text>You successfully uninstall the extra infusions.</text>
    <remove name="HIDDEN UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK"/>
    <choice>
        <text>Continue...</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_UNINSTALL_PHOENIX">
    <text>You successfully uninstall the extra infusions.</text>
    <remove name="HIDDEN UPG_LILY_INFUSION_PHOENIX_UNLOCK"/>
    <choice>
        <text>Continue...</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_INSTALL_FOURTH">
    <text>Which infusions do you want to install? [Installing multiple allows you to switch between them outside of combat.]</text>
    <choice req="UPG_LILY_INFUSION_OVERLOADED_UNLOCK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Overloaded Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_OVERLOADED_UNLOCK" lvl="0" max_group="0"  blue="false" hidden="true">
        <text>Overloaded Infusions. [50~, 5{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_OVERLOADED"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_CHAOTIC_UNLOCK" lvl="1" max_group="1"  blue="false" hidden="true">
        <text>Chaotic Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_CHAOTIC_UNLOCK" lvl="0" max_group="1"  blue="false" hidden="true">
        <text>Chaotic Infusions. [20~, 5{, 5}, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_CHAOTIC"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_FIREBORNE_UNLOCK" lvl="1" max_group="2"  blue="false" hidden="true">
        <text>Fireborne Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_FIREBORNE_UNLOCK" lvl="0" max_group="2"  blue="false" hidden="true">
        <text>Fireborne Infusions. [40~, 3{, 4}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_FIREBORNE"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK" lvl="1" max_group="3"  blue="false" hidden="true">
        <text>Explosive Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK" lvl="0" max_group="3"  blue="false" hidden="true">
        <text>Explosive Infusions. [50~, 8}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_EXPLOSIVE"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_PHOENIX_UNLOCK" lvl="1" max_group="4"  blue="false" hidden="true">
        <text>Phoenix Infusions. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_INFUSION_PHOENIX_UNLOCK" lvl="0" max_group="4"  blue="false" hidden="true">
        <text>Phoenix Infusions. [50~, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_PHOENIX"/>
    </choice>


    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_OVERLOADED">
    <text>You are about to install the Overloaded Infusions upgrade.
	[Infusion Effects: Stuns self and all nearby crew for 5s and deals 2 ion damage to system. Systems on your ship have 1 ion removed instead.
30 HP/% heal, 21 second sickness.]</text>

    <choice req="lily_infusion_bay" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="fuel" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INFUSION_OVERLOADED"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_infusion_bay" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Infusion bay level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INFUSION_OVERLOADED">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <variable name="lily_infusion_bay_fourthtype_select" op="set" val="1"/>
    <hiddenAug>UPG_LILY_INFUSION_OVERLOADED_UNLOCK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_CHAOTIC">
    <text>You are about to install the Chaotic Infusions upgrade.
	[Infusion Effects: Applies an effect of a random other infusion. Hopefully there isn't any adverse effects on your crew.
15 - 75 HP/% heal, 7 second sickness.]</text>

    <choice req="lily_infusion_bay" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [20~, 5{, 5}, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="fuel" min="-5" max="-5"/>
                <item type="missiles" min="-5" max="-5"/>
                <item type="drones" min="-5" max="-5"/>

            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INFUSION_CHAOTIC"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_infusion_bay" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Infusion bay level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INFUSION_CHAOTIC">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <variable name="lily_infusion_bay_fourthtype_select" op="set" val="2"/>
    <hiddenAug>UPG_LILY_INFUSION_CHAOTIC_UNLOCK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_FIREBORNE">
    <text>You are about to install the Fireborne Infusions upgrade.
	[Infusion Effects: Starts a fire in current room. Grants ability to heal from fires for the duration, but also makes your crew suffocate at rapid speed, even if they are normally immune.
15 HP/% heal, 21 second sickness.]</text>

    <choice req="lily_infusion_bay" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 3{, 4}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="fuel" min="-3" max="-3"/>
                <item type="missiles" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INFUSION_FIREBORNE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_infusion_bay" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Infusion bay level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INFUSION_FIREBORNE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <variable name="lily_infusion_bay_fourthtype_select" op="set" val="3"/>
    <hiddenAug>UPG_LILY_INFUSION_FIREBORNE_UNLOCK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_EXPLOSIVE">
    <text>You are about to install the Explosive Infusions upgrade.
	[Infusion Effects: Explodes, damaging all enemies in the room by 15 HP. System on enemy ships take 1 damage, while on your ship are repaired by 1 bar instead. <!--Grants lingering 3 HP/s regeneration for the duration.-->
15 HP/% heal, 14 second sickness.]</text>

    <choice req="lily_infusion_bay" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [50~, 8}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="missiles" min="-8" max="-8"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INFUSION_EXPLOSIVE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_infusion_bay" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Infusion bay level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INFUSION_EXPLOSIVE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <variable name="lily_infusion_bay_fourthtype_select" op="set" val="4"/>
    <hiddenAug>UPG_LILY_INFUSION_EXPLOSIVE_UNLOCK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_INFUSION_BAY_PHOENIX">
    <text>You are about to install the Phoenix Infusions upgrade.
	[Infusion Effects: Crew cannot die during the duration. If they take damage that would normally kill them, they are instead healed to full health and teleported to the Infusion Bay. When this effect triggers, allies in the same room are healed by 30 HP/%, and the Infusion Bay takes 1 unresistable ion damage with double lockout duration. Won't save your boarders if enemy ship explodes.
15 HP/% heal, 14 second sickness.]</text>

    <choice req="lily_infusion_bay" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_INFUSION_PHOENIX"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_infusion_bay" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Infusion bay level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_INFUSION_PHOENIX">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <variable name="lily_infusion_bay_fourthtype_select" op="set" val="5"/>
    <hiddenAug>UPG_LILY_INFUSION_PHOENIX_UNLOCK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_OXYGEN">
    <mod-append:choice req="UPG_CREW_OXYGEN" lvl="4" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation. [MAX LVL ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_CREW_OXYGEN" lvl="3" max_lvl="3" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 4. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_CREW_OXYGEN" lvl="2" max_lvl="2" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 3. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_CREW_OXYGEN" lvl="1" max_lvl="1" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 2. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_CREW_OXYGEN" lvl="0" max_lvl="0" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 1. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </mod-append:choice>

    <mod-append:choice req="UPG_LILY_OXYGEN_FLORAL" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Floral Bouquet. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_OXYGEN_FACTORY" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Factory Grease. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_OXYGEN_METAL" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Metal and Gunpowder. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>    
    <mod-append:choice req="UPG_LILY_OXYGEN_ARCTIC" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Arctic Wind. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_OXYGEN_LAZULI" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Lapis Lazuli. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_OXYGEN_BATTERY" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - 9V Battery. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_OXYGEN_ALPHA" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Alpha-Methylphenethylamine. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="OXYGEN_FLAVOR_ANY" lvl="0" max_lvl="0" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal.</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_FLAVOR"/>
    </mod-append:choice>


    <mod-append:choice req="UPG_LILY_OXYGEN_BACKUP" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Backup Oxygen. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_OXYGEN_BACKUP" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Backup Oxygen. [Cost: 10~, 2{]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_BACKUP"/>
    </mod-append:choice>
</mod:findName>



<event name="STORAGE_CHECK_SYSTEM_OXYGEN">
    <text>What upgrade do you want to install?</text>

    <choice req="UPG_CREW_OXYGEN" lvl="4" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation. [MAX LVL ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_CREW_OXYGEN" lvl="3" max_lvl="3" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 4. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </choice>
    <choice req="UPG_CREW_OXYGEN" lvl="2" max_lvl="2" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 3. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </choice>
    <choice req="UPG_CREW_OXYGEN" lvl="1" max_lvl="1" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 2. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </choice>
    <choice req="UPG_CREW_OXYGEN" lvl="0" max_lvl="0" max_group="4" blue="false" hidden="true">
        <text>Advanced Ventilation LvL 1. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN"/>
    </choice>

    <choice req="UPG_LILY_OXYGEN_FLORAL" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Floral Bouquet. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_FACTORY" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Factory Grease. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_METAL" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Metal and Gunpowder. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_ARCTIC" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Arctic Wind. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_LAZULI" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Lapis Lazuli. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_BATTERY" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - 9V Battery. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_ALPHA" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal - Alpha-Methylphenethylamine. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="OXYGEN_FLAVOR_ANY" lvl="0" max_lvl="0" max_group="5" blue="false" hidden="true">
        <text>Particulate Dispersal.</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_FLAVOR"/>
    </choice>


    <choice req="UPG_LILY_OXYGEN_BACKUP" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Backup Oxygen. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_BACKUP" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Backup Oxygen. [Cost: 10~, 2{]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_BACKUP"/>
    </choice>

    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>

<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_OXYGEN" reverse="false" start="1">
    <mod:removeTag/>
</mod:findName>



<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_FLAVOR">
    <text>Installing dispersal system for particulates - which provide various morale and health boosts to allied crew onboard your ships.
Select which particular flavor do you want to install.
[The options are mutually exclusive, scale will power provided to life support system, and will only apply to rooms with oxygen on your own ship.]</text>
    <choice req="UPG_LILY_OXYGEN_FLORAL" lvl="0" blue="false" hidden="true">
        <text>Particulate Dispersal - Floral Bouquet. [20~, 5{, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_FLORAL"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_FACTORY" lvl="0" blue="false" hidden="true">
        <text>Particulate Dispersal - Factory Grease. [25~, 6|]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_FACTORY"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_METAL" lvl="0" blue="false" hidden="true">
        <text>Particulate Dispersal - Metal and Gunpowder. [25~, 5}, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_METAL"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_ARCTIC" lvl="0" blue="false" hidden="true">
        <text>Particulate Dispersal - Arctic Wind. [25~, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_ARCTIC"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_LAZULI" lvl="0" blue="false" hidden="true">
        <text>Particulate Dispersal - Lapis Lazuli. [50~, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_LAZULI"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_BATTERY" lvl="0" blue="false" hidden="true">
        <text>Particulate Dispersal - 9V Battery. [25~, 7{, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_BATTERY"/>
    </choice>
    <choice req="UPG_LILY_OXYGEN_ALPHA" lvl="0" blue="false" hidden="true">
        <text>Particulate Dispersal - Alpha-Methylphenethylamine. [15~, 4{, 4}, 4|]</text>
        <event load="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_ALPHA"/>
    </choice>


    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_FLORAL">
    <text>You are about to install the Particulate Dispersal - Floral Bouquet upgrade.
A fine concoction of aromas developed by Orchid Caretakers, designed to improve the well-being of your crew.
[Effects: +5% max health and +10% healing speed for each powered level of life support. Only works on your ship, in rooms that have at least 20% oxygen.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 5{, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="fuel" min="-5" max="-5"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_FLORAL"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_FLORAL" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_FLORAL"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_FLORAL"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_FLORAL">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_FLORAL</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_FACTORY">
    <text>You are about to install the Particulate Dispersal - Factory Grease upgrade.
A concoction often dispersed in Vampweed facilities, as it was discovered to inspire workers to be more productive.
[Effects: +10% repair speed and +5% movement speed for each powered level of life support. Only works on your ship, in rooms that have at least 20% oxygen.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 25~, 6|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-25" max="-25"/>
                <item type="drones" min="-6" max="-6"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_FACTORY"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_FACTORY" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_FACTORY"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_FACTORY"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_FACTORY">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_FACTORY</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_METAL">
    <text>You are about to install the Particulate Dispersal - Metal and Gunpowder upgrade.
A mixture known well around hardened pirates, its harsh flavor helps steel your crew for combat.
[Effects: +5% combat damage and -5% combat damage taken for each powered level of life support. Only works on your ship, in rooms that have at least 20% oxygen.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 25~, 5}, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-25" max="-25"/>
                <item type="missiles" min="-5" max="-5"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_METAL"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_METAL" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_METAL"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_METAL"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_METAL">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_METAL</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_ARCTIC">
    <text>You are about to install the Particulate Dispersal - Arctic Wind upgrade.
A very refreshing flavor of this will make your crew move like the wind and deal with fires easily.
[Effects: +10% movement speed, -20% fire damage taken and +20% fire extinguishing speed for each powered level of life support. Only works on your ship, in rooms that have at least 20% oxygen.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_ARCTIC"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_ARCTIC" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_ARCTIC"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_ARCTIC"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_ARCTIC">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_ARCTIC</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_LAZULI">
    <text>You are about to install the Particulate Dispersal - Lapis Lazuli upgrade.
The calming and focusing effects of this expesive mixture will help to make minds of your crew unmovable as the mountains.
[Effects: -20% stun duration for each powered level of life support. At level 2, crew resists madness, and at level 3, crew resists mind control. (Note: extra effects require oxygen in the room to be at least 95%) Only works on your ship, in rooms that have at least 20% oxygen.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_LAZULI"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_LAZULI" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_LAZULI"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_LAZULI"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_LAZULI">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_LAZULI</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_BATTERY">
    <text>You are about to install the Particulate Dispersal - 9V Battery upgrade.
It is uncertain how you can make a battery considered a "flavor". But most of the test subject agree that the effect was "positively jolting".
[Effects: +15% power recharge rate for each powered level of life support. At level 3, all Zoltan crew provide an extra bar of power. Only works on your ship, in rooms that have at least 20% oxygen.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 7{, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="fuel" min="-7" max="-7"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_BATTERY"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_BATTERY" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_BATTERY"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_BATTERY"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_BATTERY">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_BATTERY</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_ALPHA">
    <text>You are about to install the Particulate Dispersal - Alpha-Methylphenethylamine upgrade.
A classic and proven solution, this should DEFINITELY give your crew a boost.
SIDE EFFECTS INCLUDE: Excessive agressiveness, restlessness, sleep problems, addiction, hallucinations, teeth grinding, and poor decision making. But hey, if it works, it works.
[Effects: +20% movement speed, +20% damage, +50% sabotage damage, +15% repair speed, and +5% power recharge rate, but also -5% max health, -10% healing speed and +10% combat damage taken for your crew for each powered level of life support. Only works on your ship, in rooms that have at least 10% oxygen.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 15~, 4{, 4}, 4|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-15" max="-15"/>
                <item type="fuel" min="-4" max="-4"/>
                <item type="missiles" min="-4" max="-4"/>
                <item type="drones" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_ALPHA"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_ALPHA" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_ALPHA"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_ALPHA"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_ALPHA">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_ALPHA</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_OXYGEN_CREW_OXYGEN">
    <text>You are about to install the Advanced Ventilation upgrade.
	[Effects: Life Support now prioritizes your crew, refilling oxygen 80% faster in rooms where crew are present. Has the opposite effect on enemy crew and fires, draining oxygen. Requires the system to be powered, and scales with power.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_CREW_OXYGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="CREW_OXYGEN" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="CREW_OXYGEN"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_CREW_OXYGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_CREW_OXYGEN">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_CREW_OXYGEN</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_OXYGEN_LILY_OXYGEN_BACKUP">
    <text>You are about to install the Oxygen Backup upgrade.
	[Effects: Life Support system provides a tiny amount of oxygen in the system room even if it's destroyed or disabled.]</text>

    <choice req="oxygen" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 10~, 2{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-10" max="-10"/>
                <item type="fuel" min="-2" max="-2"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_BACKUP"/>
            </choice>
        </event>
    </choice>
    <choice req="oxygen" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Oxygen level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_OXYGEN_BACKUP" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_OXYGEN_BACKUP"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_OXYGEN_BACKUP"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_OXYGEN_BACKUP">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_OXYGEN_BACKUP</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>







<mod:findName type="event" name="STORAGE_CHECK_SYSTEM_BATTERY">
    <mod:findLike type="choice">
        <mod:selector req="UPG_BATTERY_BOOSTER"/>
        <mod:setAttributes req="LILY_BATTERY_ADVANCED" />
    </mod:findLike>
    <mod-append:choice req="LILY_BATTERY_ADVANCED" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Surge Overdrive. [UNAVAILABLE]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="LILY_BATTERY_ADVANCED" lvl="0" max_group="5" blue="false" hidden="true">
        <text>Surge Overdrive. [Cost: 50~, 5{, 5}, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_BATTERY_SURGE_OVERDRIVE"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_BATTERY_SOLAR_POWER" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Solar Battery. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </mod-append:choice>
    <mod-append:choice req="UPG_LILY_BATTERY_SOLAR_POWER" lvl="0" max_group="6" blue="false" hidden="true">
        <text>Solar Battery. [Cost: 15~, 1|]</text>
        <event load="STORAGE_CHECK_SYSTEM_BATTERY_SOLAR_POWER"/>
    </mod-append:choice>
</mod:findName>


<event name="STORAGE_CHECK_SYSTEM_BATTERY_SURGE_OVERDRIVE">
    <text>You are about to install the Surge Overdrive upgrade.
	[Effects: While your backup battery is active, receive +10% weapon charge rate, +20% shield recharge rate and +5% evasion for each backup battery level, but battery cooldown is increased by 25%.
Incompatible with battery performance upgrades.]</text>

    <choice req="battery" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5{, 5}, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="fuel" min="-5" max="-5"/>
                <item type="missiles" min="-5" max="-5"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BATTERY_SURGE_OVERDRIVE"/>
            </choice>
        </event>
    </choice>
    <choice req="battery" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Backup Battery level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BATTERY_SURGE_OVERDRIVE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BATTERY_SURGE_OVERDRIVE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BATTERY_SURGE_OVERDRIVE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BATTERY_SURGE_OVERDRIVE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BATTERY_SURGE_OVERDRIVE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_BATTERY_SOLAR_POWER">
    <text>You are about to install the Solar Battery upgrade.
	[Effects: When close to a sun, backup battery can be active indefinitely.]</text>

    <choice req="battery" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 15~, 1|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-15" max="-15"/>
                <item type="drones" min="-1" max="-1"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BATTERY_SOLAR_POWER"/>
            </choice>
        </event>
    </choice>
    <choice req="battery" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Backup Battery level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BATTERY_SOLAR_POWER" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BATTERY_SOLAR_POWER"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BATTERY_SOLAR_POWER"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BATTERY_SOLAR_POWER">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BATTERY_SOLAR_POWER</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS">
    <text>What upgrade do you want to install?</text>
    <choice req="UPG_LILY_BUNKER_BRACERS" lvl="1" max_group="1" blue="false" hidden="true">
        <text>Fortifications. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_BUNKER_BRACERS" lvl="0" max_group="1" blue="false" hidden="true">
        <text>Fortifications. [Cost: 30~]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_BUNKER"/>
    </choice>
    <choice req="UPG_LILY_BRACERS_THERMAL" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Thermal Kinetic Dischargers. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_BRACERS_THERMAL" lvl="0" max_group="2" blue="false" hidden="true">
        <text>Thermal Kinetic Dischargers. [Cost: 15~, 4}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_THERMAL"/>
    </choice>
    <choice req="UPG_LILY_BRACERS_REGEN" lvl="1" max_group="3" blue="false" hidden="true">
        <text>Living Metal Bracers. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_BRACERS_REGEN" lvl="0" max_group="3" blue="false" hidden="true">
        <text>Living Metal Bracers. [Cost: 40~, 4|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_REGEN"/>
    </choice>
    <choice req="UPG_LILY_BRACERS_COVERAGE" lvl="1" max_group="4" blue="false" hidden="true">
        <text>Integrity Field Generator. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_BRACERS_COVERAGE" lvl="0" max_group="4" blue="false" hidden="true">
        <text>Integrity Field Generator. [Cost: 60~, 5{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_COVERAGE"/>
    </choice>


    

    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_BUNKER">
    <text>You are about to install the Fortifications upgrade.
	[Effects: Allied crew in System Bracers room take half damage from all sources, and enemy crew sabotage it at half speed.]</text>

    <choice req="lily_system_bracers" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BUNKER_BRACERS"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_system_bracers" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need System Bracers level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BUNKER_BRACERS" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BUNKER_BRACERS"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BUNKER_BRACERS"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BUNKER_BRACERS">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BUNKER_BRACERS</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_THERMAL">
    <text>You are about to install the Thermal Kinetic Dischargers upgrade.
	[Effects: System Bracers have a 50% chance to not lose durability but instead catch fire when absorbing damage.]</text>

    <choice req="lily_system_bracers" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 15~, 4}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-15" max="-15"/>
                <item type="missiles" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_THERMAL"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_system_bracers" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need System Bracers level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BRACERS_THERMAL" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BRACERS_THERMAL"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_THERMAL"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BRACERS_THERMAL">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BRACERS_THERMAL</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_REGEN">
    <text>You are about to install the Living Metal Bracers upgrade.
	[Effects: Made out of special metal that can "remember" shapes, System Bracers will slowly repair themselves even in the absense of crew.]</text>

    <choice req="lily_system_bracers" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 4|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="drones" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_REGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_system_bracers" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need System Bracers level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BRACERS_REGEN" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BRACERS_REGEN"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_REGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BRACERS_REGEN">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BRACERS_REGEN</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_SYSTEM_BRACERS_COVERAGE">
    <text>You are about to install the Integrity Field Generator upgrade.
	[Effects: System Bracers now protect systems from other sources of damage, such as sabotage and fires.]</text>

    <choice req="lily_system_bracers" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 60~, 5{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-60" max="-60"/>
                <item type="fuel" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_COVERAGE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_system_bracers" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need System Bracers level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BRACERS_COVERAGE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BRACERS_COVERAGE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_COVERAGE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BRACERS_COVERAGE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BRACERS_COVERAGE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_AETHER_LILY_BRACERS_AETHER">
    <text>You are about to install the Aether Integrity Field upgrade.
	[Effects: Systems protected by System Bracers are now sabotaged at half speed, and deal 2 hp/s damage to intruders.]</text>

    <choice req="UPG_LILY_BRACERS_COVERAGE" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5{, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="fuel" min="-5" max="-5"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_AETHER"/>
            </choice>
        </event>
    </choice>
    <choice req="UPG_LILY_BRACERS_COVERAGE" lvl="0" max_lvl="0" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need to have Integrity Field Generator internal upgrade. (System Bracers)</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_BRACERS_AETHER" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_BRACERS_AETHER"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_BRACERS_AETHER"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_BRACERS_AETHER">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_BRACERS_AETHER</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER">
    <text>What upgrade do you want to install?</text>
    <choice req="UPG_LILY_FIBER_STRONG" lvl="1" max_group="1" blue="false" hidden="true">
        <text>Double Weaving. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_FIBER_STRONG" lvl="0" max_group="1" blue="false" hidden="true">
        <text>Double Weaving. [Cost: 40~, 4|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_STRONG"/>
    </choice>
    <choice req="UPG_LILY_FIBER_HAZARD" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Hazmat Layer. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_FIBER_HAZARD" lvl="0" max_group="2" blue="false" hidden="true">
        <text>Hazmat Layer. [Cost: 40~, 5{, 3}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_HAZARD"/>
    </choice>
    <choice req="UPG_LILY_FIBER_PRIORITY" lvl="1" max_group="3" blue="false" hidden="true">
        <text>Dynamic Priority. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_FIBER_PRIORITY" lvl="0" max_group="3" blue="false" hidden="true">
        <text>Dynamic Priority. [Cost: 25~, 4|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_PRIORITY"/>
    </choice>
    <choice req="UPG_LILY_FIBER_REGEN" lvl="1" max_group="4" blue="false" hidden="true">
        <text>Living Fibers. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_FIBER_REGEN" lvl="0" max_group="4" blue="false" hidden="true">
        <text>Living Fibers. [Cost: 80~, 6{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_REGEN"/>
    </choice>


    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_STRONG">
    <text>You are about to install the Double Weaving upgrade.
	[Effects: Fiber Lining protection is now twice as effective, but is repaired by crew at halved speed.]</text>

    <choice req="lily_fiber_liner" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 4|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="drones" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_STRONG"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_fiber_liner" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Fiber Liner level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_FIBER_STRONG" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_FIBER_STRONG"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_STRONG"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_FIBER_STRONG">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_FIBER_STRONG</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_HAZARD">
    <text>You are about to install the Hazmat Layer upgrade.
	[Effects: Fiber Lining now also reduces status chance (fire, breach, stun) of projectiles and beams hitting your hull.]</text>

    <choice req="lily_fiber_liner" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 5{, 3}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="fuel" min="-5" max="-5"/>
                <item type="missiles" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_HAZARD"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_fiber_liner" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Fiber Liner level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_FIBER_HAZARD" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_FIBER_HAZARD"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_HAZARD"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_FIBER_HAZARD">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_FIBER_HAZARD</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_PRIORITY">
    <text>You are about to install the Dynamic Priority upgrade.
	[Effects: Fiber Lining now only applies its protection (and therefore takes damage) to rooms with allied crew present.]</text>

    <choice req="lily_fiber_liner" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 25~, 4|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-25" max="-25"/>
                <item type="drones" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_PRIORITY"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_fiber_liner" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Fiber Liner level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_FIBER_PRIORITY" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_FIBER_PRIORITY"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_PRIORITY"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_FIBER_PRIORITY">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_FIBER_PRIORITY</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_FIBER_LINER_REGEN">
    <text>You are about to install the Living Fibers upgrade.
	[Effects: A special living fiber liner material is capable of feeding off power leaks on your ship, and regenerate itself naturally even in the absence of crew.]</text>

    <choice req="lily_fiber_liner" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 80~, 6{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-80" max="-80"/>
                <item type="fuel" min="-6" max="-6"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_REGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_fiber_liner" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Fiber Liner level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_FIBER_REGEN" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_FIBER_REGEN"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_REGEN"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_FIBER_REGEN">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_FIBER_REGEN</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_AETHER_LILY_FIBER_AETHER">
    <text>You are about to install the Aether Fiber Clothing upgrade.
	[Effects: Special clothing made from living fibers infused with aether. Provides your crew with 20% damage reduction from all sources and constant 2 hp/s regeneration.]</text>

    <choice req="UPG_LILY_FIBER_REGEN" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 8{, 6|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="fuel" min="-8" max="-8"/>
                <item type="drones" min="-6" max="-6"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_AETHER"/>
            </choice>
        </event>
    </choice>
    <choice req="UPG_LILY_FIBER_REGEN" lvl="0" max_lvl="0" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need to have Living Fibers internal upgrade. (Fiber Liner)</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_FIBER_AETHER" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_FIBER_AETHER"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_FIBER_AETHER"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_FIBER_AETHER">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_FIBER_AETHER</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE">
    <text>What upgrade do you want to install?</text>
    <!--choice req="UPG_LILY_TARGETING_ANTICLOAK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Full Spectrum Array. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_ANTICLOAK" lvl="0" max_group="0" blue="false" hidden="true">
        <text>Full Spectrum Array. [Cost: 100~, 8{, 6|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_ANTICLOAK"/>
    </choice-->

    <choice req="UPG_LILY_TARGETING_AUTOLOCK" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Preemptive lock-on. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_AUTOLOCK" lvl="0" max_group="0" blue="false" hidden="true">
        <text>Preemptive lock-on. [Cost: 30~, 3}, 3|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_AUTOLOCK"/>
    </choice>

    <choice req="UPG_LILY_TARGETING_STATUS" lvl="1" max_group="1" blue="false" hidden="true">
        <text>Enhanced Weapon Tuning. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_STATUS" lvl="0" max_group="1" blue="false" hidden="true">
        <text>Enhanced Weapon Tuning. [Cost: 60~, 6{, 6}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_STATUS"/>
    </choice>

    <choice req="UPG_LILY_TARGETING_RELOAD" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Weapon Charging Optimization. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_RELOAD" lvl="0" max_group="2" blue="false" hidden="true">
        <text>Weapon Charging Optimization. [Cost: 60~, 10}]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_RELOAD"/>
    </choice>

    <choice req="UPG_LILY_TARGETING_HOMING" lvl="1" max_group="3" blue="false" hidden="true">
        <text>Nano-Guidance System. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_HOMING" lvl="0" max_group="3" blue="false" hidden="true">
        <text>Nano-Guidance System. [Cost: 40~, 5}, 2|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_HOMING"/>
    </choice>

    <choice req="UPG_LILY_TARGETING_UPLINK" lvl="1" max_group="4" blue="false" hidden="true">
        <text>Weakpoint Data Uplink. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_UPLINK" lvl="0" max_group="4" blue="false" hidden="true">
        <text>Weakpoint Data Uplink. [Cost: 50~, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_UPLINK"/>
    </choice>

    <choice req="UPG_LILY_TARGETING_OVERCLOCK" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Processor Overclocking. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_OVERCLOCK" lvl="0" max_lvl="0" max_group="5" blue="false" hidden="true">
        <text>Processor Overclocking. [Cost: 30~, 5{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_OVERCLOCK"/>
    </choice>

    <choice req="UPG_LILY_TARGETING_MULTITHREAD" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Multithreaded Targeting. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_TARGETING_MULTITHREAD" lvl="0" max_lvl="0" max_group="6" blue="false" hidden="true">
        <text>Multithreaded Targeting. [Cost: 45~, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_MULTITHREAD"/>
    </choice>

    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_ANTICLOAK">
    <text>You are about to install the Full Spectrum Array upgrade.
	[Effects: Doubles the accuracy bonus of Dedicated Targeting Core and allows charging of weapons at 20% of regular speed per level when target is cloaked. Also expands provided vision to adjacent rooms.]</text>

    <choice req="lily_targeting_core" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 100~, 8{, 6|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-100" max="-100"/>
                <item type="fuel" min="-8" max="-8"/>
                <item type="drones" min="-6" max="-6"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_ANTICLOAK"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_ANTICLOAK" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_ANTICLOAK"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_ANTICLOAK"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_ANTICLOAK">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_ANTICLOAK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_AUTOLOCK">
    <text>You are about to install the Preemptive lock-on upgrade.
	[Effects: If enemy ship has cloaking system, automatically and instantly locks onto it at the start of the battle.]</text>

    <choice req="lily_targeting_core" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 3}, 3|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="missiles" min="-3" max="-3"/>
                <item type="drones" min="-3" max="-3"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_AUTOLOCK"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_AUTOLOCK" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_AUTOLOCK"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_AUTOLOCK"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_AUTOLOCK">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_AUTOLOCK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_STATUS">
    <text>You are about to install the Enhanced Weapon Tuning upgrade. 
	[Effects: If a weapon has fire/breach/stun chance, this chance is increased by Core Strength * 5%. (Rounded up to nearest 10%)]</text>

    <choice req="lily_targeting_core" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 60~, 6{, 6}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-60" max="-60"/>
                <item type="fuel" min="-6" max="-6"/>
                <item type="missiles" min="-6" max="-6"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_STATUS"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_STATUS" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_STATUS"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_STATUS"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_STATUS">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_STATUS</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_RELOAD">
    <text>You are about to install the Weapon Charging Optimization upgrade.
	[Effects: Dedicated Targeting Core now provides extra 5% weapon reload boost per Core Strength.]</text>

    <choice req="lily_targeting_core" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 60~, 10}]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-60" max="-60"/>
                <item type="missiles" min="-10" max="-10"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_RELOAD"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_RELOAD" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_RELOAD"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_RELOAD"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_RELOAD">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_RELOAD</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_HOMING">
    <text>You are about to install the Nano-Guidance System upgrade.
	[Effects: Weapons with spread (such as flak) will now attempt to hit closer to the target, by 10 units per Core Strength.]</text>

    <choice req="lily_targeting_core" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 5}, 2|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="missiles" min="-5" max="-5"/>
                <item type="drones" min="-2" max="-2"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_HOMING"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_HOMING" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_HOMING"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_HOMING"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_HOMING">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_HOMING</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_UPLINK">
    <text>You are about to install the Weakpoint Data Uplink upgrade.
	[Effects: Allied crew in targeted rooms will deal 20% more sabotage damage and 10% more combat damage per Core Strength.]</text>

    <choice req="lily_targeting_core" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_UPLINK"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_UPLINK" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_UPLINK"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_UPLINK"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_UPLINK">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_UPLINK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_OVERCLOCK">
    <text>You are about to install the Processor Overclocking upgrade.
	[Effects: Reduces time it takes for Dedicated Targeting Core to lock onto a room from 6 to 1.5 seconds.]</text>

    <choice req="lily_targeting_core" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 30~, 5{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-30" max="-30"/>
                <item type="fuel" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_OVERCLOCK"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_OVERCLOCK" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_OVERCLOCK"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_OVERCLOCK"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_OVERCLOCK">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_OVERCLOCK</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>

<event name="STORAGE_CHECK_SYSTEM_LILY_TARGETING_CORE_MULTITHREAD">
    <text>You are about to install the Multithreaded Targeting upgrade.
	[Effects: Dedicated Targeting Core now also applies its full effects to rooms adjacent to directly targeted.]</text>

    <choice req="lily_targeting_core" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 45~, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-45" max="-45"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_MULTITHREAD"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_targeting_core" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need Dedicated Targeting Core level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_TARGETING_MULTITHREAD" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_TARGETING_MULTITHREAD"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_TARGETING_MULTITHREAD"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_TARGETING_MULTITHREAD">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_TARGETING_MULTITHREAD</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>




<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE">
    <text>What upgrade do you want to install?</text>

    <choice req="UPG_LILY_ECM_ANTIDRONE" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Cld. Comms Jammer. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_ECM_ANTIDRONE" lvl="0" max_group="0" blue="false" hidden="true">
        <text>Cld. Comms Jammer. [Cost: 45~, 5|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_ANTIDRONE"/>
    </choice>

    <choice req="UPG_LILY_ECM_CAPACITY" lvl="3" max_group="1" blue="false" hidden="true">
        <text>ECM Capacitor Bank. [MAX LVL ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_ECM_CAPACITY" lvl="2" max_group="1" blue="false" hidden="true">
        <text>ECM Capacitor Bank lvl 3. [Cost: 20~, 2|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_CAPACITY"/>
    </choice>
    <choice req="UPG_LILY_ECM_CAPACITY" lvl="1" max_group="1" blue="false" hidden="true">
        <text>ECM Capacitor Bank lvl 2. [Cost: 20~, 2|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_CAPACITY"/>
    </choice>
    <choice req="UPG_LILY_ECM_CAPACITY" lvl="0" max_group="1" blue="false" hidden="true">
        <text>ECM Capacitor Bank lvl 1. [Cost: 20~, 2|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_CAPACITY"/>
    </choice>

    <choice req="UPG_LILY_ECM_RETARGET" lvl="1" max_group="2" blue="false" hidden="true">
        <text>'Loyalist' Anti-Missile. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_ECM_RETARGET" lvl="0" max_group="2" blue="false" hidden="true">
        <text>'Loyalist' Anti-Missile. [Cost: 50~, 8}, 4|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_RETARGET"/>
    </choice>

    <choice req="UPG_LILY_ECM_SUPERCHARGE" lvl="1" max_group="3" blue="false" hidden="true">
        <text>Supercharge Protocol. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_ECM_SUPERCHARGE" lvl="0" max_group="3" blue="false" hidden="true">
        <text>Supercharge Protocol. [Cost: 40~, 8{, 2|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_SUPERCHARGE"/>
    </choice>

    <choice req="UPG_LILY_ECM_ASB_SCRAMBLER" lvl="1" max_group="4" blue="false" hidden="true">
        <text>ASB Scrambler. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_ECM_ASB_SCRAMBLER" lvl="0" max_group="4" blue="false" hidden="true">
        <text>ASB Scrambler. [Cost: 80~, 10|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_ASB_SCRAMBLER"/>
    </choice>

    <choice req="UPG_LILY_ECM_ELECTRO_FIELD" lvl="1" max_group="5" blue="false" hidden="true">
        <text>Ion Counterfield. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_ECM_ELECTRO_FIELD" lvl="0" max_lvl="0" max_group="5" blue="false" hidden="true">
        <text>Ion Counterfield. [Cost: 50~, 5{]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_ELECTRO_FIELD"/>
    </choice>

    <choice req="UPG_LILY_ECM_JAMMER_FIELD" lvl="1" max_group="6" blue="false" hidden="true">
        <text>Jamming Screen. [ALREADY INSTALLED]</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="UPG_LILY_ECM_JAMMER_FIELD" lvl="0" max_lvl="0" max_group="6" blue="false" hidden="true">
        <text>Jamming Screen. [Cost: 60~, 8|]</text>
        <event load="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_JAMMER_FIELD"/>
    </choice>

    <choice>
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_ANTIDRONE">
    <text>You are about to install the Cooled Comms Jammer upgrade.
	[Effects: ECM suite offensive and defensive drone disruption abilities have instant cooldown.]</text>

    <choice req="lily_ecm_suite" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 45~, 5|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-45" max="-45"/>
                <item type="drones" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_ANTIDRONE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ecm_suite" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need ECM Suite level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_ECM_ANTIDRONE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_ECM_ANTIDRONE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_ANTIDRONE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_ECM_ANTIDRONE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_ECM_ANTIDRONE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_CAPACITY">
    <text>You are about to install the ECM Capacitor Bank upgrade.
	[Effects: ECM suite gains +1 Max charge, can be installed up to 3 times.]</text>

    <choice req="lily_ecm_suite" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 20~, 2|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-20" max="-20"/>
                <item type="drones" min="-2" max="-2"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_CAPACITY"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ecm_suite" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need ECM Suite level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_ECM_CAPACITY" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_ECM_CAPACITY"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_CAPACITY"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_ECM_CAPACITY">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_ECM_CAPACITY</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_RETARGET">
    <text>You are about to install the 'Loyalist' Anti-Missile upgrade.
	[Effects: ECM suite missile disruption ability now retargets enemy missiles back at them.]</text>

    <choice req="lily_ecm_suite" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 8}, 4|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-45"/>
                <item type="missiles" min="-8" max="-8"/>
                <item type="drones" min="-4" max="-4"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_RETARGET"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ecm_suite" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need ECM Suite level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_ECM_RETARGET" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_ECM_RETARGET"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_RETARGET"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_ECM_RETARGET">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_ECM_RETARGET</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_SUPERCHARGE">
    <text>You are about to install the Supercharge Protocol upgrade.
	[Effects: ECM gains an ability that temporary doubles its recharge speed, but prevents use of other abilities while it's active.]</text>

    <choice req="lily_ecm_suite" lvl="1" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 40~, 8{, 2|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-40" max="-40"/>
                <item type="fuel" min="-8" max="-8"/>
                <item type="drones" min="-2" max="-2"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_SUPERCHARGE"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ecm_suite" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need ECM Suite level 1.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_ECM_SUPERCHARGE" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_ECM_SUPERCHARGE"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_SUPERCHARGE"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_ECM_SUPERCHARGE">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_ECM_SUPERCHARGE</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_ASB_SCRAMBLER">
    <text>You are about to install the ASB Scrambler upgrade.
	[Effects: Prevents hostile ASBs from hitting your ship while your ECM system is powered.]</text>

    <choice req="lily_ecm_suite" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 80~, 10|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-80" max="-80"/>
                <item type="drones" min="-10" max="-10"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_ASB_SCRAMBLER"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ecm_suite" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need ECM Suite level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_ECM_ASB_SCRAMBLER" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_ECM_ASB_SCRAMBLER"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_ASB_SCRAMBLER"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_ECM_ASB_SCRAMBLER">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_ECM_ASB_SCRAMBLER</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_ELECTRO_FIELD">
    <text>You are about to install the Ion Counterfield upgrade.
	[Effects: Reduces enemy ion resistance by 50% while your ECM system is powered.]</text>

    <choice req="lily_ecm_suite" lvl="2" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 50~, 5{]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-50" max="-50"/>
                <item type="fuel" min="-5" max="-5"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_ELECTRO_FIELD"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ecm_suite" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need ECM Suite level 2.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_ECM_ELECTRO_FIELD" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_ECM_ELECTRO_FIELD"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_ELECTRO_FIELD"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_ECM_ELECTRO_FIELD">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_ECM_ELECTRO_FIELD</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>


<event name="STORAGE_CHECK_SYSTEM_LILY_ECM_SUITE_JAMMER_FIELD">
    <text>You are about to install the Jamming Screen upgrade.
	[Effects: Passively reduces enemy accuracy, reload speed and shield recharge by 10%, 15% and 20% respectively while your ECM system is powered. However, it gains charges 25% slower.]</text>

    <choice req="lily_ecm_suite" lvl="3" max_group="0" blue="false" hidden="true">
        <text>Perform the upgrade. [Cost: 60~, 8|]</text>
        <event>
            <text>You install the upgrade.</text>
            <item_modify>
                <item type="scrap" min="-60" max="-60"/>
                <item type="drones" min="-8" max="-8"/>
            </item_modify>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_JAMMER_FIELD"/>
            </choice>
        </event>
    </choice>
    <choice req="lily_ecm_suite" max_group="0" blue="false" hidden="true">
        <text>This upgrade is unavailable. You need ECM Suite level 3.</text>
        <event load="OPTION_INVALID"/>
    </choice>
    <choice req="EX_LILY_ECM_JAMMER_FIELD" max_group="1" blue="false" hidden="true">
        <text>Install the External Augment internally.</text>
        <event>
            <text>You install the upgrade.</text>
            <remove name="EX_LILY_ECM_JAMMER_FIELD"/>
            <choice hidden="true">
                <text>Continue...</text>
                <event load="INSTALL_LILY_ECM_JAMMER_FIELD"/>
            </choice>
        </event>
    </choice>
    <choice req="pilot" lvl="1" max_group="2" blue="false" hidden="true">
        <text>Nevermind.</text>
        <event load="STORAGE_CHECK_SYSTEM_LOAD"/>
    </choice>
</event>
<event name="INSTALL_LILY_ECM_JAMMER_FIELD">
    <variable name="loc_internal_upgrades" op="add" val="1"/>
    <hiddenAug>UPG_LILY_ECM_JAMMER_FIELD</hiddenAug>
    <loadEvent>STORAGE_CHECK_SYSTEM</loadEvent>
</event>



<mod:findName type="event" name="COMBAT_CHECK_REAL">
    <mod-append:choice req="LILY_ECM_ASB_SCRAMBLER_ACTIVATE" lvl="1" blue="true">
        <text>(ASB Scrambler) Retarget the ASB to fire at the enemy!</text>
        <event load="COMBAT_CHECK_LILY_ECM_ASB_RETARGET"/>
    </mod-append:choice>
</mod:findName>

<event name="COMBAT_CHECK_LILY_ECM_ASB_RETARGET">
    <text>You use your advanced equipment to scramble the ASB battery and make it fire at the enemy ship instead!</text>
    <environment type="PDS" target="enemy"/>
    <variable name="mods_lilyinno_ecmsuite_asb_disabled" op="set" value="1"/>
    <choice>
        <text>Continue...</text>
        <event/>
    </choice>
</event>





<mod:findName type="event" name="COMBAT_CHECK_TOGGLE">
    <mod-append:choice req="lily_ablative_armor_rendering_disabled" lvl="0" max_lvl="0" blue="false">
        <text>Disable ablative armor rendering.</text>
        <event>
            <metaVariable name="lily_ablative_armor_rendering_disabled" op="set" value="1"/>
        </event>
    </mod-append:choice>
    <mod-append:choice req="lily_ablative_armor_rendering_disabled" lvl="1" blue="false">
        <text>Enable ablative armor rendering.</text>
        <event>
            <metaVariable name="lily_ablative_armor_rendering_disabled" op="set" value="0"/>
        </event>
    </mod-append:choice>

    <mod-append:choice req="lily_system_bracers_rendering_disabled" lvl="0" max_lvl="0" blue="false">
        <text>Disable system bracers rendering.</text>
        <event>
            <metaVariable name="lily_system_bracers_rendering_disabled" op="set" value="1"/>
        </event>
    </mod-append:choice>
    <mod-append:choice req="lily_system_bracers_rendering_disabled" lvl="1" blue="false">
        <text>Enable system bracers rendering.</text>
        <event>
            <metaVariable name="lily_system_bracers_rendering_disabled" op="set" value="0"/>
        </event>
    </mod-append:choice>

    <mod-append:choice req="lily_fiber_liner_rendering_disabled" lvl="0" max_lvl="0" blue="false">
        <text>Disable fiber liner rendering.</text>
        <event>
            <metaVariable name="lily_fiber_liner_rendering_disabled" op="set" value="1"/>
        </event>
    </mod-append:choice>
    <mod-append:choice req="lily_fiber_liner_rendering_disabled" lvl="1" blue="false">
        <text>Enable fiber liner rendering.</text>
        <event>
            <metaVariable name="lily_fiber_liner_rendering_disabled" op="set" value="0"/>
        </event>
    </mod-append:choice>

    <mod-append:choice req="lily_targeting_core_sounds_disabled" lvl="0" max_lvl="0" blue="false">
        <text>Disable targeting core sounds.</text>
        <event>
            <metaVariable name="lily_targeting_core_sounds_disabled" op="set" value="1"/>
        </event>
    </mod-append:choice>
    <mod-append:choice req="lily_targeting_core_sounds_disabled" lvl="1" blue="false">
        <text>Enable targeting core sounds.</text>
        <event>
            <metaVariable name="lily_targeting_core_sounds_disabled" op="set" value="0"/>
        </event>
    </mod-append:choice>

    <mod-append:choice req="lily_ecm_suite_sounds_disabled" lvl="0" max_lvl="0" blue="false">
        <text>Disable ECM suite sounds.</text>
        <event>
            <metaVariable name="lily_ecm_suite_sounds_disabled" op="set" value="1"/>
        </event>
    </mod-append:choice>
    <mod-append:choice req="lily_ecm_suite_sounds_disabled" lvl="1" blue="false">
        <text>Enable ECM suite sounds.</text>
        <event>
            <metaVariable name="lily_ecm_suite_sounds_disabled" op="set" value="0"/>
        </event>
    </mod-append:choice>


</mod:findName>



<mod:findName type="event" name="STORAGE_CHECK_AUG">
    <mod-append:choice req="UPG_LILY_SENSORS_MAPWIDE">
        <text>(Mapping Suite) Map the sector. [1 fleet boost]</text>
        <event load="STORAGE_CHECK_AUG_SENSORS_MAPWIDE_SCAN"/>
    </mod-append:choice>
    <mod-append:choice req="EX_LILY_SENSORS_MAPWIDE">
        <text>(Ex. Mapping Suite) Map the sector. [1 fleet boost]</text>
       <event load="STORAGE_CHECK_AUG_SENSORS_MAPWIDE_SCAN"/>
    </mod-append:choice>
</mod:findName>

<event name="STORAGE_CHECK_AUG_SENSORS_MAPWIDE_SCAN">
    <text>You unfold your giant mapping sensor array and stay at low power for some time to avoid disturbance. This long process will surely give the fleet some time to catch up, but now you have gathered a detailed map of the whole sector!</text>
    <modifyPursuit amount="1"/>
    <reveal_map/>
</event>


</FTL>